name: .NET Core

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
#    - name: Setup .NET Core
#      uses: actions/setup-dotnet@v1
#      with:
#        dotnet-version: 3.1.301
    - name: Install dependencies
      run: |
        dotnet add PrimeService.Tests package GitHub.TestLogger -v 1.0.1 --no-restore
        dotnet add PrimeService.Tests package coverlet.collector -v 1.3.0 --no-restore
        dotnet restore
#        dotnet add PrimeService.Tests package coverlet.msbuild -v 2.9.0 --no-restore
      working-directory: ${{ github.workspace }}
    - name: Build
      run: dotnet build --no-restore
    - name: Run tests
      run: dotnet test --collect:"XPlat Code Coverage" --no-build --no-restore --logger "github;name=my-test-report;GITHUB_TOKEN=${{secrets.GITHUB_TOKEN}}" || cd .
      working-directory: ${{ github.workspace }}
#    - name: Fio benchmark
#      run: |
#         dotnet restore -v d
#        echo "Running FIO"
#        sudo apt-get update
#        sudo apt-get install fio
#        fio --randrepeat=1 --direct=1 --gtod_reduce=1 --name=test --bs=128k --iodepth=32 --readwrite=rw --rwmixread=75 --size=200M --filename=PhysicalDrive1 --thread=1
#        D:\a\MSTest-sample\MSTest-sample\fio --randrepeat=1 --direct=1 --gtod_reduce=1 --name=test --bs=128k --iodepth=32 --readwrite=rw --rwmixread=75 --size=200M --ioengine=windowsaio --filename=PhysicalDrive1 --thread=1
#       PowerShell Get-PsDrive -PsProvider FileSystem
      

